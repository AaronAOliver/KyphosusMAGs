p8
dev.off()
svg(paste(taxa,"raxml_scfas.svg", sep = "_"), width = 12, height = 11)
bin_sulfrd = data.frame(read.csv("bin_sulf_reduct.tab", sep = "\t"))
bin_sulfrd$Sulfate.Reduction  = factor(bin_sulfrd$Sulfate.Reduction, levels=c('Complete Pathway', 'Incomplete Pathway', 'No marker gene'))
p8 = p7 + new_scale_fill() +
geom_fruit(
data=bin_sulfrd,
geom=geom_star,
mapping=aes(y=MAG_id, fill=Sulfate.Reduction),
starshape = 24,
size=2.5,
angle=15,
starstroke=0,
offset=0.1,
pwidth=0.1,
inherit.aes = FALSE,
grid.params=list(
linetype=3,
size=0.1
))+
scale_fill_manual(
name="Sulfate Reduction",
values=c("green", "orange", "white"),
limits = c('Complete Pathway', 'Incomplete Pathway'),
guide=guide_legend(keywidth=1, keyheight=1, order=4,
override.aes=list(
starshape=c('Complete Pathway' = 24, 'Incomplete Pathway' = 24),
size=2),
),
na.translate=FALSE,
)  +
theme(
legend.background=element_rect(fill=NA),
legend.title=element_text(size=7),
legend.text=element_text(size=5.5),
legend.spacing.y = unit(0.02, "cm")
)
p8
dev.off()
library(ggplot2)
library("stringr")
library(tidyr)
df = as.data.frame(read.csv("cazy_sulf_nr.tsv", sep = "\t"))
df$annot = as.factor(df$annot)
df$nr_id = as.numeric(df$nr_id)
df$self_id = as.numeric(df$self_id)
df$sulf_id = as.numeric(df$sulf_id)
df$dbCAN_id = as.numeric(df$dbCAN_id)
df_sulf = df[str_detect(df$annot, "S1_"), ]
# tabulate the id variable
tab <- table(df_sulf$annot)
# Get the names of the ids that we care about.
# In this case the ids that occur >= 3 times
idx <- names(tab)[tab >= 20]
idx = c("S1_13", "S1_72", "S1_19", "S1_8", "S1_24", "S1_4", "S1_11", "S1_20", "S1_15", "S1_16", "S1_17", "S1_28", "S1_25", "S1_14", "S1_27")
# Only look at the data that we care aboutd
df_sulf2 = df_sulf[df_sulf$annot %in% idx,]
df_sulf_pivot = df_sulf2 %>%
pivot_longer(nr_id:sulf_id, names_to = "blast", values_to = "id")
df_sulf_pivot$blast =  factor(df_sulf_pivot$blast, levels = c("self_id", "nr_id", "sulf_id"))
df_sulf_pivot$annot = factor(df_sulf_pivot$annot,
idx)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity")
valid_cazy = c("GH16_16", "GH50", "GH117", "GH82", "GH150", "GH16_11", "GH16_12", "GH86", "GH10", "GH11", "GH30", "PL40", "PL6", "PL7", "PL8", "PL38", "GH165", "GH29", "GH95")
df_cazy = df[df$annot %in% valid_cazy,]
df_cazy_pivot = df_cazy %>%
pivot_longer(c(nr_id, self_id, dbCAN_id), names_to = "blast", values_to = "id")
df_cazy_pivot$blast =  factor(df_cazy_pivot$blast, levels = c("self_id", "nr_id", "dbCAN_id"))
df_cazy_pivot$annot <- factor(df_cazy_pivot$annot,     # Reorder factor levels
valid_cazy)
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + + theme(axis.text.x = element_text(size = 20))
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 20))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 16))
svg("sulf_boxplot.svg", width = 12, height = 11)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 16))
dev.off()
dev.off()
svg("sulf_boxplot.svg", width = 12, height = 11)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 16))
dev.off()
svg("sulf_boxplot.svg", width = 10, height = 5)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 16))
dev.off()
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 12, color = "black"))
svg("sulf_boxplot.svg", width = 10, height = 5)
valid_cazy = c("GH16_16", "GH50", "GH117", "GH82", "GH150", "GH16_11", "GH16_12", "GH86", "GH10", "GH11", "GH30", "PL40", "PL6", "PL7", "PL8", "PL38", "GH165", "GH29", "GH95")
dev.off()
svg("sulf_boxplot.svg", width = 10, height = 5)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 12, color = "black"))
dev.off()
dev.off()
svg("sulf_boxplot.svg", width = 10, height = 5)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black"))
dev.off()
svg("sulf_boxplot.svg", width = 10, height = 5)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black"), axis.text.y = element_text(size = 11, color = "black"))
dev.off()
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black"), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
svg("sulf_boxplot.svg", width = 10, height = 5)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black"), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 10, height = 5)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 11, color = "black"), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 10, height = 5)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 10, color = "black"), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
dev.off()
valid_cazy = c("GH16_16", "GH50", "GH117", "GH82", "GH150", "GH16_11", "GH16_12", "GH86", "GH10", "GH11", "PL40", "PL6", "PL7", "PL8", "PL38", "GH29", "GH95")
cazy_colors = c("red","red","red","red","red","red","red","red","red","brown","brown","brown","brown","brown","brown","brown","brown")
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 10, color = cazy_colors), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 10, height = 5)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 10, color = cazy_colors), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
valid_cazy = c("GH16_16", "GH50", "GH117", "GH82", "GH150", "GH16_11", "GH16_12", "GH86", "GH10", "PL40", "PL6", "PL7", "PL8", "PL38", "GH29", "GH95")
cazy_colors = c("red","red","red","red","red","red","red","red","red","red","brown","brown","brown","brown","brown","brown","brown","brown")
df_cazy = df[df$annot %in% valid_cazy,]
df_cazy_pivot = df_cazy %>%
pivot_longer(c(nr_id, self_id, dbCAN_id), names_to = "blast", values_to = "id")
df_cazy_pivot$blast =  factor(df_cazy_pivot$blast, levels = c("self_id", "nr_id", "dbCAN_id"))
df_cazy_pivot$annot <- factor(df_cazy_pivot$annot,     # Reorder factor levels
valid_cazy)
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 10, height = 5)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 10, color = cazy_colors), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 8, height = 4)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 9.5, color = cazy_colors), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
svg("sulf_boxplot.svg",width = 8, height = 4)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 8, color = "black"), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
valid_cazy = c("GH16_16", "GH50", "GH117", "GH82", "GH150", "GH16_11", "GH16_12", "GH86", "GH10", "PL40", "PL6", "PL7", "PL8", "PL38", "GH29", "GH95")
cazy_colors = c("red","red","red","red","red","red","red","red","red","red","brown","brown","brown","brown","brown","brown","brown","brown")
df_cazy = df[df$annot %in% valid_cazy,]
df_cazy_pivot = df_cazy %>%
pivot_longer(c(nr_id, self_id, dbCAN_id), names_to = "blast", values_to = "id")
df_cazy_pivot$blast =  factor(df_cazy_pivot$blast, levels = c("self_id", "nr_id", "dbCAN_id"))
df_cazy_pivot$annot <- factor(df_cazy_pivot$annot,     # Reorder factor levels
valid_cazy)
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 8, height = 4)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 8, color = cazy_colors), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 8, color = cazy_colors,angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
svg("sulf_boxplot.svg",width = 8, height = 4)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
valid_cazy = c("GH16_16", "GH50", "GH117", "GH82", "GH150", "GH16_11", "GH16_12", "GH86", "GH10", "PL40", "PL6", "PL7", "PL8", "PL38", "GH29", "GH95")
cazy_colors = c("red","red","red","red","red","red","red","red","red","red","brown","brown","brown","brown","brown","brown","brown","brown")
df_cazy = df[df$annot %in% valid_cazy,]
df_cazy_pivot = df_cazy %>%
pivot_longer(c(nr_id, self_id, dbCAN_id), names_to = "blast", values_to = "id")
df_cazy_pivot$blast =  factor(df_cazy_pivot$blast, levels = c("self_id", "nr_id", "dbCAN_id"))
df_cazy_pivot$annot <- factor(df_cazy_pivot$annot,     # Reorder factor levels
valid_cazy)
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 8, height = 4)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 11, color = cazy_colors,angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
valid_cazy = c("GH16_16", "GH82", "GH86", "GH10", "GH16_11","GH50", "GH117", "GH150", "GH16_12", "PL40", "PL6", "PL38", "GH29", "PL7", "PL8", "GH95")
cazy_colors = c("red","red","red","red","red","red","red","red","red","red","brown","brown","brown","brown","brown","brown","brown","brown")
df_cazy = df[df$annot %in% valid_cazy,]
df_cazy_pivot = df_cazy %>%
pivot_longer(c(nr_id, self_id, dbCAN_id), names_to = "blast", values_to = "id")
df_cazy_pivot$blast =  factor(df_cazy_pivot$blast, levels = c("self_id", "nr_id", "dbCAN_id"))
df_cazy_pivot$annot <- factor(df_cazy_pivot$annot,     # Reorder factor levels
valid_cazy)
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 8, height = 4)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 11, color = cazy_colors,angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
valid_cazy = c("GH16_16", "GH86", "GH10", "GH16_11","GH82","GH50", "GH117", "GH150", "GH16_12", "PL40", "PL6", "PL38", "GH29", "PL7", "PL8", "GH95")
cazy_colors = c("red","red","red","red","red","red","red","red","red","red","brown","brown","brown","brown","brown","brown","brown","brown")
df_cazy = df[df$annot %in% valid_cazy,]
df_cazy_pivot = df_cazy %>%
pivot_longer(c(nr_id, self_id, dbCAN_id), names_to = "blast", values_to = "id")
df_cazy_pivot$blast =  factor(df_cazy_pivot$blast, levels = c("self_id", "nr_id", "dbCAN_id"))
df_cazy_pivot$annot <- factor(df_cazy_pivot$annot,     # Reorder factor levels
valid_cazy)
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 8, height = 4)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 11, color = cazy_colors,angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
valid_cazy = c("GH16_16", "GH86", "GH16_11", "GH10", "GH82","GH50", "GH117", "GH150", "GH16_12", "PL40", "PL6", "PL38", "GH29", "PL7", "PL8", "GH95")
cazy_colors = c("red","red","red","red","red","red","red","red","red","red","brown","brown","brown","brown","brown","brown","brown","brown")
valid_cazy = c("GH16_16", "GH86", "GH16_11", "GH10", "GH82","GH50", "GH117", "GH150", "GH16_12", "PL40", "PL6", "PL38", "GH29", "PL8", "PL7", "GH95")
cazy_colors = c("red","red","red","red","red","red","red","red","red","red","brown","brown","brown","brown","brown","brown","brown","brown")
df_cazy = df[df$annot %in% valid_cazy,]
df_cazy_pivot = df_cazy %>%
pivot_longer(c(nr_id, self_id, dbCAN_id), names_to = "blast", values_to = "id")
df_cazy_pivot$blast =  factor(df_cazy_pivot$blast, levels = c("self_id", "nr_id", "dbCAN_id"))
df_cazy_pivot$annot <- factor(df_cazy_pivot$annot,     # Reorder factor levels
valid_cazy)
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 8, height = 4)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 11, color = cazy_colors,angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100)
dev.off()
View(df_cazy_pivot)
library(diplyr)
library(dplyr)
View(df_sulf)
sulf_summary = df_sulf_pivot %>% group_by(c(prot, annot)) %>% tally()
sulf_summary = df_sulf_pivot %>% group_by(prot, annot) %>% tally()
View(sulf_summary)
sulf_summary = df_sulf_pivot %>% group_by(annot)
View(sulf_summary)
sulf_summary = df_sulf_pivot %>% group_by(annot) %>% tally()
View(sulf_summary)
sulf_summary$n = sulf_summary$n / 3
View(sulf_summary)
View(sulf_summary)
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1)
sulf_summary$blast = "nr"
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1)
sulf_summary$blast = "nr_id"
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1)
svg("sulf_boxplot.svg",width = 8, height = 4)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 100) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1)
dev.off()
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 110) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1)
svg("sulf_boxplot.svg",width = 8, height = 4)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 110) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1)
dev.off()
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 110) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 0.5)
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 110) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1.5)
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 110) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1.25)
svg("sulf_boxplot.svg",width = 8, height = 4)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 110) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1.25)
dev.off()
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 105) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1.25)
svg("sulf_boxplot.svg",width = 8, height = 4)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 105) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1.25)
dev.off()
dev.off()
svg("sulf_boxplot.svg",width = 8, height = 4)
p <- ggplot(df_sulf_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'SulfAtlas')) + guides(fill= guide_legend(title = "Database"))  +  xlab("Sulfatase Subfamily") +
ylab("Percent Identity") + theme(axis.text.x = element_text(size = 11, color = "black", angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 105) +
geom_text(data = sulf_summary,
aes(annot, Inf, label = n), vjust = 1.5)
dev.off()
cazy_summary = df_cazy_pivot %>% group_by(annot) %>% tally()
cazy_summary$n = cazy_summary$n / 3
cazy_summary$blast = "nr_id"
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 8, height = 4)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 11, color = cazy_colors,angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 105) +
geom_text(data = cazy_summary,
aes(annot, Inf, label = n), vjust = 1.5)
dev.off()
valid_cazy = c("GH16_16", "GH86", "GH16_11", "GH10", "GH82","GH50", "GH117", "GH150", "GH16_12", "PL40", "PL6", "PL38", "GH29", "PL8", "GH95")
cazy_colors = c("red","red","red","red","red","red","red","red","red","red","brown","brown","brown","brown","brown","brown","brown")
df_cazy = df[df$annot %in% valid_cazy,]
df_cazy_pivot = df_cazy %>%
pivot_longer(c(nr_id, self_id, dbCAN_id), names_to = "blast", values_to = "id")
df_cazy_pivot$blast =  factor(df_cazy_pivot$blast, levels = c("self_id", "nr_id", "dbCAN_id"))
df_cazy_pivot$annot <- factor(df_cazy_pivot$annot,     # Reorder factor levels
valid_cazy)
cazy_summary = df_cazy_pivot %>% group_by(annot) %>% tally()
cazy_summary$n = cazy_summary$n / 3
cazy_summary$blast = "nr_id"
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 8, height = 4)
#p + geom_jitter(height = 0, width = 0.25) #+ geom_violin(width = 1.7)
#p + geom_violin(width = 1.7)
svg("cazy_boxplot.svg", width = 8, height = 4)
p <- ggplot(df_cazy_pivot, aes(annot, id, fill=blast))
p + geom_boxplot() + theme_bw() + scale_fill_discrete(labels=c('Kyphosid Gut', 'Genbank nr', 'CAZy db')) + guides(fill= guide_legend(title = "Database"))  +  xlab("CAZyme Class") +
ylab("Percent Identity")+ theme(axis.text.x = element_text(size = 11, color = cazy_colors,angle = 90, vjust = 0.5, hjust=1), axis.text.y = element_text(size = 11, color = "black")) + ylim(20, 105) +
geom_text(data = cazy_summary,
aes(annot, Inf, label = n), vjust = 1.5)
dev.off()
# Read data from file
data <- read.csv("data/bin_quality.txt", stringsAsFactors = FALSE, sep="\t")
setwd("~/GitHub/KyphosusMAGs")
# Read data from file
data <- read.csv("data/bin_quality.txt", stringsAsFactors = FALSE, sep="\t")
sample_order = c("R1_6", "R1_12", "R1_24", "R1_25", "R1_28", "R1_29", "R1_38", "R1_43", "R2_8", "R2_24", "R2_26",
"F5GI_2", "F5GI_3", "F5HG_2", "F5HG_3", "F6GI_3", "F6GI_4", "F6HG_2", "F6HG_3",
"F7GI_2", "F7GI_3", "F7HG_2", "F7HG_3", "F8GI_2", "F8GI_3", "F8HG_2", "F8HG_3")
data$id = factor(data$id, levels = sample_order)
View(data)
data_long = melt(data, id.vars = "id", variable_name = "count")
# Read data from file
data <- as.data.table(read.csv("data/bin_quality.txt", stringsAsFactors = FALSE, sep="\t"))
# Read data from file
data <- as.data.table(read.csv("data/bin_quality.txt", stringsAsFactors = FALSE, sep="\t"))
sample_order = c("R1_6", "R1_12", "R1_24", "R1_25", "R1_28", "R1_29", "R1_38", "R1_43", "R2_8", "R2_24", "R2_26",
"F5GI_2", "F5GI_3", "F5HG_2", "F5HG_3", "F6GI_3", "F6GI_4", "F6HG_2", "F6HG_3",
"F7GI_2", "F7GI_3", "F7HG_2", "F7HG_3", "F8GI_2", "F8GI_3", "F8HG_2", "F8HG_3")
# Read data from file
data <- read.csv("data/bin_quality.txt", stringsAsFactors = FALSE, sep="\t")
sample_order = c("R1_6", "R1_12", "R1_24", "R1_25", "R1_28", "R1_29", "R1_38", "R1_43", "R2_8", "R2_24", "R2_26",
"F5GI_2", "F5GI_3", "F5HG_2", "F5HG_3", "F6GI_3", "F6GI_4", "F6HG_2", "F6HG_3",
"F7GI_2", "F7GI_3", "F7HG_2", "F7HG_3", "F8GI_2", "F8GI_3", "F8HG_2", "F8HG_3")
data$id = factor(data$id, levels = sample_order)
data_long = data %>%
pivot_longer(
cols = c("Medium.Quality", "High.Quality"),
names_to = "quality",
values_to = "bins"
)
# Get visualization packages
if (!require('ggplot2')) install.packages('ggplot2'); library('ggplot2')
if (!require('RColorBrewer')) install.packages('RColorBrewer'); library('RColorBrewer')
if (!require('ggbeeswarm')) install.packages('ggbeeswarm'); library('ggbeeswarm')
if (!require('cowplot')) install.packages('cowplot'); library('cowplot')
if (!require('stringr')) install.packages('stringr'); library('stringr')
# Get data manipulation packages
if (!require('tidyverse')) install.packages('tidyverse'); library('tidyverse')
if (!require('tidyr')) install.packages('tidyr'); library('tidyr')
if (!require('dplyr')) install.packages('dplyr'); library('dplyr')
if (!require('reshape2')) install.packages('reshape2'); library('reshape2')
# Read data from file
data <- read.csv("data/bin_quality.txt", stringsAsFactors = FALSE, sep="\t")
sample_order = c("R1_6", "R1_12", "R1_24", "R1_25", "R1_28", "R1_29", "R1_38", "R1_43", "R2_8", "R2_24", "R2_26",
"F5GI_2", "F5GI_3", "F5HG_2", "F5HG_3", "F6GI_3", "F6GI_4", "F6HG_2", "F6HG_3",
"F7GI_2", "F7GI_3", "F7HG_2", "F7HG_3", "F8GI_2", "F8GI_3", "F8HG_2", "F8HG_3")
data$id = factor(data$id, levels = sample_order)
data_long = data %>%
pivot_longer(
cols = c("Medium.Quality", "High.Quality"),
names_to = "quality",
values_to = "bins"
)
View(data_long)
ggplot(data, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity")
ggplot(data_long, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity")
ggplot(data_long, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity") + theme_bw() + + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(data_long, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity") + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(data_long, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity") + labs(x = "Sample", y = "Number of MAGs", fill = "MAG Quality") + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(data_long, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity") + labs(x = "Sample", y = "Number of MAGs", fill = "MAG Quality") +
scale_fill_manual(labels =
c("High Quality", "Medium Quality"), values = c("Orange", "Blue")
) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggplot(data_long, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity") + labs(x = "Sample", y = "Number of MAGs", fill = "MAG Quality") +
scale_fill_manual(labels =
c("High Quality", "Medium Quality"), values = c("Orange", "skyBlue")
) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
svg("bin_count.svg", width = 7, height = 5)
ggplot(data_long, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity") + labs(x = "Sample", y = "Number of MAGs", fill = "MAG Quality") +
scale_fill_manual(labels =
c("High Quality", "Medium Quality"), values = c("Orange", "skyBlue")
) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
svg("bin_count.svg", width = 5, height = 3)
ggplot(data_long, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity") + labs(x = "Sample", y = "Number of MAGs", fill = "MAG Quality") +
scale_fill_manual(labels =
c("High Quality", "Medium Quality"), values = c("Orange", "skyBlue")
) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
svg("bin_count.svg", width = 6, height = 4.5)
ggplot(data_long, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity") + labs(x = "Sample", y = "Number of MAGs", fill = "MAG Quality") +
scale_fill_manual(labels =
c("High Quality", "Medium Quality"), values = c("Orange", "skyBlue")
) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
svg("bin_count.svg", width = 8, height = 4.5)
ggplot(data_long, aes(fill=quality, y=bins, x=id)) +
geom_bar(position="stack", stat="identity") + labs(x = "Sample", y = "Number of MAGs", fill = "MAG Quality") +
scale_fill_manual(labels =
c("High Quality", "Medium Quality"), values = c("Orange", "skyBlue")
) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
dev.off()
